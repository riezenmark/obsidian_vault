---
создал заметку: 2024-07-30
tags:
  - Programming
  - Education
  - Scala
---
Неявные преобразования — это мощная функция Scala, применяемая в двух распространенных вариантах: 
- разрешить пользователям предоставлять аргумент одного типа так, как если бы это был другой тип, чтобы избежать написания бойлерплейтного кода.
- в Scala 2 для предоставления дополнительных членов запечатанным классам (заменены [[Методы расширения|методами расширения]] в Scala 2).
### Способы задания
#### Scala 2
В Scala 2 неявное преобразование из типа `S` в тип `T` определяется либо [[Неявные классы|неявным классом]] `T` с одним параметром типа `S`, либо [[Контекстные (неявные) параметры|неявным значением]], которое имеет тип функции `S => T`, либо неявным методом, преобразуемым в значение этого типа.

Например, следующий код определяет неявное преобразование из `Int` в `Long`:
```scala
import scala.language.implicitConversions

implicit def int2long(x: Int): Long = x.toLong
```
Это неявный метод, преобразуемый в значение типа `Int => Long`.
#### Scala 3
В Scala 3 неявное преобразование из типа `S` в тип `T` определяется экземпляром [[Контекстные (неявные) параметры#Ещё пример использования given (именованных)|given]], который имеет тип `scala.Conversion[S, T]`. Для совместимости со Scala 2 их также можно определить неявным методом (подробнее читайте во вкладке Scala 2).

Например, этот код определяет неявное преобразование из `Int` в `Long`:
```scala
given int2long: Conversion[Int, Long] with
  def apply(x: Int): Long = x.toLong
```
Как и другие given определения, неявные преобразования могут быть анонимными:
```scala
given Conversion[Int, Long] with
  def apply(x: Int): Long = x.toLong
```
Используя псевдоним, это можно выразить более кратко:
```scala
given Conversion[Int, Long] = (x: Int) => x.toLong
```
### Применение
Неявные преобразования применяются в двух случаях:
1. Если выражение `e` имеет тип `S` и `S` не соответствует ожидаемому типу выражения `T`.
2. При выборе `e.m`, где `e` типа `S`, если селектор `m` не указывает на элемент `S`.

В первом случае ищется конверсия `c`, применимая к `e` и тип результата которой соответствует `T`.

Примером является передача `scala.Int`, например `x`, методу, который ожидает `scala.Long`. В этом случае вставляется неявное преобразование `Int.int2long(x)`.

Во втором случае ищется преобразование `c`, применимое к `e` и результат которого содержит элемент с именем `m`.

Примером является сравнение двух строк `"foo" < "bar"`. В этом случае `String` не имеет члена `<`, поэтому вставляется неявное преобразование `Predef.augmentString("foo") < "bar"` (`scala.Predef` автоматически импортируется во все программы Scala).